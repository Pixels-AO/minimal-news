<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Minimal News Reader Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    font-family: sans-serif;
    margin: 0; padding: 0; background: #f9f9f9; line-height: 1.5;
  }
  h1 {
    background: #333; color: white; text-align: center; padding: 10px; margin: 0;
  }
  section {
    padding: 10px;
    border-bottom: 1px solid #ddd;
  }
  h2 {
    margin-top: 0;
    color: #444;
  }
  ul {
    list-style: none; padding: 0; margin: 0;
  }
  li {
    margin-bottom: 8px;
  }
  a {
    cursor: pointer;
    color: #0066cc;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  /* Modal overlay for article reading */
  #readerModal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    overflow-y: auto;
    padding: 20px;
    z-index: 9999;
  }
  #readerContent {
    background: white;
    max-width: 600px;
    margin: auto;
    padding: 20px;
    border-radius: 6px;
  }
  #readerContent h3 {
    margin-top: 0;
  }
  #closeReader {
    float: right;
    font-size: 20px;
    cursor: pointer;
    color: #999;
  }
  #closeReader:hover {
    color: #333;
  }
</style>
</head>
<body>

<h1>Today's Headlines (Reader Mode)</h1>

<section id="bbc">
  <h2>BBC News</h2>
  <ul></ul>
</section>

<section id="aj">
  <h2>Al Jazeera</h2>
  <ul></ul>
</section>


<!-- Modal for reading article -->
<div id="readerModal" aria-hidden="true">
  <div id="readerContent" role="dialog" aria-modal="true" aria-labelledby="readerTitle">
    <span id="closeReader" title="Close">&times;</span>
    <h3 id="readerTitle"></h3>
    <div id="readerBody">Loading...</div>
  </div>
</div>

<script>
const feeds = {
  bbc: "http://feeds.bbci.co.uk/news/rss.xml",
  aj: "https://www.aljazeera.com/xml/rss/all.xml",
};

function loadFeed(sectionId, url) {
  const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`;
  fetch(apiUrl)
    .then(res => res.json())
    .then(data => {
      const list = document.querySelector(`#${sectionId} ul`);
      list.innerHTML = "";
      data.items.slice(0,5).forEach(item => {
        const li = document.createElement("li");
        // We'll attach click listener to open reader modal
        const a = document.createElement("a");
        a.textContent = item.title;
        a.href = "#";
        a.dataset.url = item.link;
        a.addEventListener("click", e => {
          e.preventDefault();
          openReader(item.title, item.link);
        });
        li.appendChild(a);
        list.appendChild(li);
      });
    })
    .catch(err => {
      console.error(`Error loading ${sectionId} feed:`, err);
      document.querySelector(`#${sectionId} ul`).innerHTML = `<li>Failed to load news.</li>`;
    });
}

function openReader(title, url) {
  const modal = document.getElementById("readerModal");
  const readerTitle = document.getElementById("readerTitle");
  const readerBody = document.getElementById("readerBody");
  readerTitle.textContent = title;
  readerBody.textContent = "Loading article...";

  modal.style.display = "block";
  modal.setAttribute("aria-hidden", "false");

  // Use allorigins proxy to bypass CORS, fetch page HTML
  fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`)
    .then(res => res.json())
    .then(data => {
      // Basic extraction: pull out all <p> content as text (very naive)
      const parser = new DOMParser();
      const doc = parser.parseFromString(data.contents, "text/html");
      // Simple heuristic: get all text inside <article> or fallback to main
      let article = doc.querySelector("article") || doc.querySelector("main") || doc.body;
      if (!article) {
        readerBody.textContent = "Sorry, article content not found.";
        return;
      }
      // Get paragraphs text only
      const paragraphs = article.querySelectorAll("p");
      if (paragraphs.length === 0) {
        readerBody.textContent = "Sorry, no readable content found.";
        return;
      }
      readerBody.innerHTML = "";
      paragraphs.forEach(p => {
        const para = document.createElement("p");
        para.textContent = p.textContent;
        readerBody.appendChild(para);
      });
    })
    .catch(err => {
      console.error("Error loading article:", err);
      readerBody.textContent = "Error loading article content.";
    });
}

// Close modal on click of X or outside click
document.getElementById("closeReader").addEventListener("click", () => {
  const modal = document.getElementById("readerModal");
  modal.style.display = "none";
  modal.setAttribute("aria-hidden", "true");
});
document.getElementById("readerModal").addEventListener("click", e => {
  if (e.target === e.currentTarget) {
    e.currentTarget.style.display = "none";
    e.currentTarget.setAttribute("aria-hidden", "true");
  }
});

loadFeed("bbc", feeds.bbc);
loadFeed("aj", feeds.aj);
</script>

</body>
</html>
